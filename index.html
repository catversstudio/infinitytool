<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Infinity Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="data.js"></script>

    <style>
        :root { --primary: #8b5cf6; --primary-glow: rgba(139, 92, 246, 0.6); --bg-dark: #020617; --panel-bg: #020617; --border: rgba(255, 255, 255, 0.1); --text-main: #f1f5f9; --text-muted: #94a3b8; --success: #10b981; --danger: #ef4444; }
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; overflow-x: hidden; font-family: 'Outfit', sans-serif; background-color: var(--bg-dark); color: var(--text-main); background-image: radial-gradient(circle at 10% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 40%), radial-gradient(circle at 90% 80%, rgba(56, 189, 248, 0.15) 0%, transparent 40%); background-attachment: fixed; -webkit-user-select: none; user-select: none; -webkit-touch-callout: none; }
        .allow-copy { -webkit-user-select: text !important; user-select: text !important; cursor: text; }
        
        /* HEADER */
        header { position: relative; z-index: 100; width: 92%; max-width: 600px; margin: 20px auto 0 auto; padding: 0.8rem 0; border-radius: 50px; background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; box-sizing: border-box; }
        .logo { font-weight: 800; font-size: 1.4rem; letter-spacing: -0.5px; display: flex; align-items: center; gap: 12px; cursor: pointer; color: white; text-shadow: 0 0 20px rgba(139, 92, 246, 0.5); }
        .logo i { color: var(--primary); filter: drop-shadow(0 0 10px var(--primary-glow)); font-size: 1.2rem; }
        #exitBtn { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); padding: 6px 15px; border-radius: 20px; font-size: 0.8rem; }

        /* INTRO */
        #introSection { width: 100%; box-sizing: border-box; text-align: center; padding: 3rem 1.5rem 1rem 1.5rem; margin: 0 auto; max-width: 800px; animation: fadeIn 0.8s ease; }
        #introTitle { font-size: 2.5rem; line-height: 1.1; margin: 0 0 10px 0; background: linear-gradient(to bottom right, #ffffff 30%, #a78bfa 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; }
        #introSub { font-size: 1.1rem; color: var(--text-muted); margin: 0; font-weight: 400; }
        .search-container { width: 100%; max-width: 500px; margin: 1.5rem auto 0 auto; position: relative; box-sizing: border-box; }
        .search-input { width: 100%; padding: 14px 20px 14px 55px; border-radius: 50px; border: 1px solid var(--border); background: rgba(255, 255, 255, 0.05); color: white; font-family: 'Outfit', sans-serif; font-size: 1rem; transition: 0.3s; box-sizing: border-box; }
        .search-input:focus { outline: none; border-color: var(--primary); background: rgba(0,0,0,0.3); box-shadow: 0 0 20px var(--primary-glow); }
        .search-icon { position: absolute; left: 22px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 1.1rem; pointer-events: none; }

        /* NAV */
        .nav-scroller { display: flex; gap: 12px; overflow-x: auto; padding: 1.5rem 20px; scrollbar-width: none; justify-content: center; box-sizing: border-box; width: 100%; }
        @media (max-width: 600px) { .nav-scroller { justify-content: flex-start; } }
        .nav-scroller::-webkit-scrollbar { display: none; }
        .nav-tab { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 0.6rem 1.2rem; border-radius: 50px; color: var(--text-muted); cursor: pointer; font-size: 0.9rem; white-space: nowrap; transition: all 0.3s ease; flex-shrink: 0; font-weight: 600; }
        .nav-tab.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 0 25px rgba(139, 92, 246, 0.4); }
        .count-badge { background: rgba(0,0,0,0.2); padding: 2px 8px; border-radius: 10px; font-size: 0.8em; margin-left: 5px; }

        /* CARDS */
        .container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 20px 20px 20px; flex: 1; box-sizing: border-box; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100%, 1fr)); gap: 1.5rem; width: 100%; }
        @media(min-width: 480px) { .grid { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); } }
        .card { background: rgba(30, 41, 59, 0.6); border: 1px solid var(--border); border-radius: 20px; overflow: hidden; text-decoration: none; color: inherit; position: relative; display: flex; flex-direction: column; transition: transform 0.3s ease, border-color 0.3s ease; backdrop-filter: blur(5px); -webkit-user-drag: none; }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .card-img-wrapper { width: 100%; height: 160px; background: #000; overflow: hidden; position: relative; }
        .card img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        .card-content { padding: 1.5rem; flex: 1; display: flex; flex-direction: column; }
        .card h3 { margin: 0 0 0.5rem 0; font-size: 1.2rem; color: white; font-weight: 600; }
        .card-desc { margin: 0 0 1rem 0; font-size: 0.9rem; color: var(--text-muted); line-height: 1.5; flex-grow: 1; }
        .copy-btn { margin-top: auto; background: rgba(255, 255, 255, 0.08); border: 1px solid var(--border); color: white; padding: 10px 12px; border-radius: 12px; font-size: 0.9rem; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; font-weight: 600; }
        .copy-btn:hover { background: rgba(255, 255, 255, 0.15); }

        /* ADMIN */
        #adminPanel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--panel-bg); padding: 2rem; box-sizing: border-box; overflow-y: auto; z-index: 5000; animation: slideUp 0.3s ease; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem; }
        .admin-section { margin-bottom: 2.5rem; padding-bottom: 2rem; border-bottom: 1px dashed var(--border); }
        .section-title { color: var(--primary); font-size: 1.2rem; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 10px; }
        .cat-tag { background: rgba(255, 255, 255, 0.05); border: 1px solid var(--primary); padding: 8px 16px; border-radius: 12px; font-size: 0.9rem; color: white; display: flex; align-items: center; gap: 10px; cursor: pointer; margin: 5px; }
        input, select, textarea { width: 100%; background: #1e293b; border: 1px solid var(--border); color: white; padding: 1rem; border-radius: 12px; font-family: inherit; margin-bottom: 1rem; box-sizing: border-box; font-size: 1rem; }
        .btn { padding: 1rem; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 100%; font-size: 1rem; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 15px var(--primary-glow); }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-main); }
        .btn-exit { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid #ef4444; padding: 0.5rem; font-size: 0.8rem; width: auto; }
        .btn-danger { background: rgba(220, 38, 38, 0.2); border: 1px solid #dc2626; color: #fca5a5; margin-top: 10px; }
        .btn-mini { padding: 0.5rem; width: auto; font-size: 0.8rem; margin-left: 5px; }
        #loginModal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 6000; display: none; justify-content: center; align-items: center; }
        .login-box { background: #0f172a; padding: 2rem; border: 1px solid var(--primary); border-radius: 20px; width: 300px; text-align: center; }
        .admin-result-card { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border); }
        .admin-result-info { font-size: 0.9rem; color: #cbd5e1; }

        .about-section { margin: 5rem auto 0 auto; padding: 3rem 2rem; width: 100%; max-width: 700px; background: linear-gradient(180deg, rgba(30, 41, 59, 0.3), rgba(15, 23, 42, 0.8)); border-radius: 24px; text-align: center; border: 1px solid var(--border); box-sizing: border-box; }
        footer { text-align: center; padding: 2rem; margin-top: auto; color: #64748b; font-size: 0.9rem; border-top: 1px solid var(--border); }
        body.corrupted { background: white !important; display: flex; justify-content: center; align-items: center; height: 100vh; }
        body.corrupted * { display: none !important; }
        body.corrupted::after { content: "SYSTEM ERROR: FILE CORRUPTED."; color: red; font-family: monospace; font-size: 2rem; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

<header id="mainHeader">
    <div class="logo" id="siteLogo"><i class="fas fa-infinity"></i> Infinity Tool</div>
    <button class="btn btn-exit" onclick="exitAdmin()" id="exitBtn" style="display:none;"> <i class="fas fa-sign-out-alt"></i> </button>
</header>

<div id="introSection">
    <h1 id="introTitle"></h1>
    <p id="introSub"></p>
    <div class="search-container">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="searchInput" class="search-input" placeholder="Search..." onkeyup="filterPosts()">
    </div>
</div>

<div class="nav-scroller" id="navContainer"></div>

<div class="container">
    <div id="adminPanel">
        <div class="admin-header">
            <div><h2 style="margin:0; font-size:1.5rem;">Dashboard</h2><div style="color:var(--text-muted); font-size:0.9rem;">Manage & Monitor</div></div>
            <button class="btn btn-exit" onclick="exitAdmin()">Close</button>
        </div>

        <div class="admin-section">
            <h4 class="section-title"><i class="fas fa-search"></i> Find & Edit</h4>
            <input type="text" id="adminSearch" placeholder="Type to find a post..." onkeyup="adminSearchFunc()">
            <div id="adminSearchResults" style="max-height: 200px; overflow-y: auto;"></div>
        </div>

        <div class="admin-section">
            <h4 class="section-title"><i class="fas fa-plus-circle"></i> Add / Edit Content</h4>
            <input type="hidden" id="editPostId">
            <select id="postCatSelect"></select>
            <input type="text" id="postTitle" placeholder="Site Name">
            <input type="url" id="postLink" placeholder="Link URL">
            <input type="text" id="postImg" placeholder="Image Link (Optional)">
            <textarea id="postDesc" rows="2" placeholder="Description"></textarea>
            <button class="btn btn-primary" onclick="addPost()" id="publishBtn">Publish</button>
            <button class="btn btn-outline" onclick="clearForm()" style="margin-top:10px;">Clear Form</button>
        </div>

        <div class="admin-section">
            <h4 class="section-title" style="color:#38bdf8;"><i class="fas fa-sliders-h"></i> Settings</h4>
            
            <label style="display:block; margin-bottom:5px; font-size:0.9rem; color:#94a3b8;">Categories</label>
            <div id="catList" style="display:flex; flex-wrap:wrap; margin-bottom:10px;"></div>
            <div style="display:flex; gap:10px; margin-bottom:1.5rem;">
                <input type="text" id="newCatName" placeholder="New Category Name" style="margin-bottom:0;">
                <button class="btn btn-primary" style="width:auto; padding:0 1.5rem; margin-bottom:0;" onclick="addCategory()">Add</button>
            </div>

            <label style="display:block; margin-bottom:5px; font-size:0.9rem; color:#94a3b8;">Header & About</label>
            <input type="text" id="editIntroTitle" placeholder="Title">
            <input type="text" id="editIntroSub" placeholder="Subtitle" style="margin-top:10px;">
            <button class="btn btn-outline" style="margin-bottom:1rem;" onclick="saveHeader()">Update Header</button>
            <textarea id="aboutEditor" rows="3"></textarea>
            <button class="btn btn-outline" onclick="saveAbout()">Save About Text</button>
            
            <hr style="border:0; border-top:1px dashed var(--border); margin: 2rem 0;">
            
            <h4 class="section-title" style="color:var(--success);"><i class="fas fa-save"></i> Data Backup</h4>
            <p style="font-size:0.9rem; color:var(--text-muted);">Use this to generate code for data.js</p>
            <button class="btn btn-primary" onclick="exportDataJS()">Copy Data Code</button>
            
            <button class="btn btn-danger" style="margin-top:20px;" onclick="requestSecureAction('reset')">âš  Reset Browser Data</button>
        </div>
    </div>

    <div id="contentArea">
        <h2 id="sectionTitle" style="font-size: 2rem; margin-bottom: 1.5rem; text-align:center;"></h2>
        <div id="postGrid" class="grid"></div>
    </div>

    <div class="about-section">
        <h3 style="color:white; margin-top:0;">About Us</h3>
        <div id="aboutDisplay" class="about-text"></div>
    </div>
</div>

<footer>&copy; 2026 CatVers Studio. All rights reserved.</footer>

<div id="loginModal">
    <div class="login-box">
        <h3 style="margin-top:0; color:white; margin-bottom:1.5rem;" id="loginTitle">System Access</h3>
        <p id="loginMsg" style="color:#ef4444; font-size:0.9rem; display:none; margin-bottom:1rem;">Confirm Identity</p>
        <input type="email" id="adminEmail" placeholder="Email">
        <input type="password" id="adminPass" placeholder="Password">
        <button class="btn btn-primary" style="margin-bottom:10px;" onclick="handleAuth()">Confirm</button>
        <button class="btn btn-outline" onclick="closeLogin()">Cancel</button>
    </div>
</div>

<script>
    // SECURITY
    document.addEventListener('keydown', e => { if((e.ctrlKey && (e.key==='I'||e.key==='u'||e.key==='s'||e.key==='p'))||e.key==='F12'){e.preventDefault(); if(e.key!=='s'&&e.key!=='p') triggerCorruption();} });
    document.addEventListener('contextmenu', e => e.preventDefault());
    function triggerCorruption(){ document.body.innerHTML=""; document.body.classList.add('corrupted'); alert("SECURITY: SYSTEM LOCKED"); }

    const ADMIN_EMAIL = "asiksingh.143@gmail.com";
    const logoBtn=document.getElementById('siteLogo'); let pressTimer;
    let pendingAction = null; let pendingData = null;   

    logoBtn.addEventListener('mousedown',()=>pressTimer=setTimeout(()=>{requestSecureAction('login')},5000));
    logoBtn.addEventListener('mouseup',()=>clearTimeout(pressTimer)); logoBtn.addEventListener('mouseleave',()=>clearTimeout(pressTimer));
    logoBtn.addEventListener('touchstart',()=>pressTimer=setTimeout(()=>{requestSecureAction('login')},5000));
    logoBtn.addEventListener('touchend',()=>clearTimeout(pressTimer));

    function requestSecureAction(action, data=null) {
        pendingAction = action; pendingData = data;
        document.getElementById('loginTitle').innerText = action === 'login' ? "Admin Login" : "Security Check";
        document.getElementById('loginMsg').style.display = action === 'login' ? 'none' : 'block';
        document.getElementById('loginModal').style.display = 'flex';
    }

    function handleAuth() {
        const eInput = document.getElementById('adminEmail').value;
        const pInput = document.getElementById('adminPass').value;
        const now = new Date();
        let hours = now.getHours();
        const minutes = now.getMinutes().toString().padStart(2, '0');
        hours = hours % 12; hours = hours ? hours : 12; 
        const validPass = `Catvers@${hours}:${minutes}`;

        if(eInput === ADMIN_EMAIL && pInput === validPass) {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('adminEmail').value = ''; document.getElementById('adminPass').value = '';
            if(pendingAction === 'login') toggleAdminUI(true);
            else if(pendingAction === 'reset') performReset();
            else if(pendingAction === 'delete') performDelete(pendingData);
            else if(pendingAction === 'edit_publish') performPublish();
            pendingAction = null; pendingData = null;
        } else { alert("ACCESS DENIED"); }
    }

    function closeLogin(){ document.getElementById('loginModal').style.display='none'; pendingAction=null; }
    function exitAdmin(){ toggleAdminUI(false); }

    // DATA LOADING (Merge data.js + LocalStorage)
    const localCats = JSON.parse(localStorage.getItem('portalCats')) || [];
    const localPosts = JSON.parse(localStorage.getItem('portalPosts')) || [];
    const dbCats = window.permanentCats || [];
    const dbPosts = window.permanentPosts || [];
    const dbSettings = window.permanentSettings || {};

    // Combine Unique
    let categories = [...dbCats, ...localCats.filter(l => !dbCats.some(d => d.id === l.id))];
    let posts = [...dbPosts, ...localPosts.filter(l => !dbPosts.some(d => d.id === l.id))];
    
    // Default fallback
    if(categories.length === 0) categories = [{id:'c1',name:'Useful Tools'}];

    let aboutText = localStorage.getItem('portalAbout') || dbSettings.aboutText || "Welcome to Infinity Tool.";
    let introData = JSON.parse(localStorage.getItem('portalIntro')) || {title: dbSettings.headerTitle || "Welcome", sub: dbSettings.headerSub || "Explore tools"};
    let activeCatId=null;

    const save=()=>{ 
        // We only save NEW items to localStorage
        const newCats = categories.filter(c => !dbCats.some(d => d.id === c.id));
        const newPosts = posts.filter(p => !dbPosts.some(d => d.id === p.id));
        localStorage.setItem('portalCats',JSON.stringify(newCats)); 
        localStorage.setItem('portalPosts',JSON.stringify(newPosts)); 
        localStorage.setItem('portalIntro',JSON.stringify(introData)); 
    };

    function toggleAdminUI(show){
        const els = { panel:document.getElementById('adminPanel'), exit:document.getElementById('exitBtn') };
        els.panel.style.display=show?'block':'none'; els.exit.style.display=show?'block':'none';
        if(show){
            document.getElementById('editIntroTitle').value=introData.title;
            document.getElementById('editIntroSub').value=introData.sub;
            document.getElementById('aboutEditor').value=aboutText;
            renderAdminSearch();
        }
        renderUI();
    }

    function adminSearchFunc() {
        const query = document.getElementById('adminSearch').value.toLowerCase();
        const resDiv = document.getElementById('adminSearchResults');
        resDiv.innerHTML = '';
        if(query.length < 2) return;
        const results = posts.filter(p => p.title.toLowerCase().includes(query));
        results.forEach(p => {
            const div = document.createElement('div'); div.className = 'admin-result-card';
            div.innerHTML = `<div class="admin-result-info">${p.title}</div><div><button class="btn btn-primary btn-mini" onclick="loadPostForEdit(${p.id})">Edit</button><button class="btn btn-danger btn-mini" onclick="requestSecureAction('delete', ${p.id})">Del</button></div>`;
            resDiv.appendChild(div);
        });
    }

    function loadPostForEdit(id) {
        const p = posts.find(x => x.id === id); if(!p) return;
        document.getElementById('editPostId').value = p.id;
        document.getElementById('postTitle').value = p.title;
        document.getElementById('postLink').value = p.link;
        document.getElementById('postImg').value = p.img;
        document.getElementById('postDesc').value = p.desc;
        document.getElementById('postCatSelect').value = p.catId;
        document.getElementById('publishBtn').innerText = "Update Post (Secure)";
        document.getElementById('adminSearchResults').innerHTML = ''; document.getElementById('adminSearch').value = '';
    }

    function addPost() { requestSecureAction('edit_publish'); }

    function performPublish() {
        const id = document.getElementById('editPostId').value;
        const t=document.getElementById('postTitle').value, l=document.getElementById('postLink').value, i=document.getElementById('postImg').value, d=document.getElementById('postDesc').value, c=document.getElementById('postCatSelect').value;
        if(!t || !l) return alert("Title & Link Required");

        if(id) {
            const idx = posts.findIndex(x => x.id == id);
            if(idx !== -1) posts[idx] = { ...posts[idx], title:t, link:l, img:i, desc:d, catId:c };
        } else {
            posts.push({id:Date.now(),catId:c,title:t,link:l,img:i,desc:d, clicks:0});
        }
        save(); clearForm(); alert("Published Successfully"); renderUI();
    }

    function performDelete(id) { 
        // Check if it's a permanent post
        if(dbPosts.some(d => d.id === id)) return alert("Cannot delete permanent Data File items via Admin. Edit data.js instead.");
        posts = posts.filter(p => p.id !== id); save(); renderUI(); adminSearchFunc(); alert("Deleted."); 
    }
    
    function performReset() { localStorage.clear(); location.reload(); }

    function clearForm() {
        document.getElementById('editPostId').value = '';
        ['postTitle','postLink','postImg','postDesc'].forEach(id=>document.getElementById(id).value='');
        document.getElementById('publishBtn').innerText = "Publish";
    }

    // EXPORT FUNCTION FOR DATA.JS
    function exportDataJS() {
        const code = `
// PASTE THIS INTO data.js
window.permanentCats = ${JSON.stringify(categories, null, 2)};
window.permanentPosts = ${JSON.stringify(posts, null, 2)};
window.permanentSettings = {
    headerTitle: "${introData.title}",
    headerSub: "${introData.sub}",
    aboutText: "${aboutText.replace(/\n/g, '\\n')}"
};
        `;
        navigator.clipboard.writeText(code).then(() => alert("Data Code Copied! Paste it into data.js"));
    }

    function renderUI(){
        const els={nav:document.getElementById('navContainer'), sel:document.getElementById('postCatSelect'), list:document.getElementById('catList'), grid:document.getElementById('postGrid')};
        els.nav.innerHTML=''; els.sel.innerHTML=''; els.list.innerHTML=''; els.grid.innerHTML='';
        
        document.getElementById('introTitle').innerText=introData.title; document.getElementById('introSub').innerText=introData.sub; document.getElementById('aboutDisplay').innerText=aboutText;

        if(categories.length===0){ els.grid.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:3rem;color:#64748b;">No categories.</div>'; return; }
        if(!activeCatId && categories.length>0) activeCatId=categories[0].id;

        categories.forEach(cat=>{
            const count = posts.filter(p => p.catId === cat.id).length;
            const tab=document.createElement('div'); tab.className=`nav-tab ${activeCatId===cat.id?'active':''}`;
            tab.innerHTML = `${cat.name} <span class="count-badge">${count}</span>`;
            tab.onclick=()=>{activeCatId=cat.id; document.getElementById('searchInput').value=''; renderUI();};
            els.nav.appendChild(tab);
            
            const opt=document.createElement('option'); opt.value=cat.id; opt.textContent=cat.name; els.sel.appendChild(opt);
            const tag=document.createElement('div'); tag.className='cat-tag'; tag.innerHTML=`${cat.name} <i class="fas fa-times"></i>`; tag.onclick=()=>deleteCategory(cat.id); els.list.appendChild(tag);
        });

        const query = document.getElementById('searchInput').value.toLowerCase();
        let filtered = [];
        if(query.length > 0) {
            filtered = posts.filter(p => p.title.toLowerCase().includes(query) || p.desc.toLowerCase().includes(query));
            document.getElementById('sectionTitle').textContent = `Search Results (${filtered.length})`;
        } else {
            const currCat=categories.find(c=>c.id===activeCatId);
            document.getElementById('sectionTitle').textContent=currCat?currCat.name:"";
            filtered = posts.filter(p=>p.catId===activeCatId);
        }

        if(filtered.length===0) els.grid.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:3rem;color:#64748b;">No sites found.</div>';
        
        filtered.forEach(post=>{
            const card=document.createElement('a'); card.className='card'; card.href=post.link;
            const isPhotoPrompt=categories.find(c=>c.id===post.catId)?.name.toLowerCase().includes("photo prompt");
            let img=post.img; if(!img) img=`https://ui-avatars.com/api/?name=${encodeURIComponent(post.title)}&background=1e293b&color=fff&size=512`;
            
            card.innerHTML=`<div class="card-img-wrapper"><img src="${img}" onerror="this.src='https://ui-avatars.com/api/?name=${post.title}'"></div><div class="card-content"><h3>${post.title}</h3><p class="card-desc ${isPhotoPrompt?'allow-copy':''}">${post.desc}</p>${isPhotoPrompt?`<button class="copy-btn" onclick="event.preventDefault(); copyText(this)"><i class="fas fa-copy"></i> Copy</button>`:''}</div>`;
            els.grid.appendChild(card);
        });
    }

    function filterPosts() { renderUI(); }
    function copyText(btn){ navigator.clipboard.writeText(btn.parentElement.querySelector('p').innerText).then(()=>{ btn.innerHTML='<i class="fas fa-check"></i>'; setTimeout(()=>btn.innerHTML='<i class="fas fa-copy"></i> Copy',1500);}); }
    
    function saveHeader(){ introData={title:document.getElementById('editIntroTitle').value,sub:document.getElementById('editIntroSub').value}; save(); renderUI(); alert("Saved"); }
    function saveAbout(){ aboutText=document.getElementById('aboutEditor').value; localStorage.setItem('portalAbout',aboutText); renderUI(); alert("Saved"); }
    function addCategory(){ const n=document.getElementById('newCatName').value; if(n){categories.push({id:'cat_'+Date.now(),name:n}); save(); document.getElementById('newCatName').value=''; renderUI();} }
    function deleteCategory(id){ 
        if(dbCats.some(d => d.id === id)) return alert("Cannot delete permanent category.");
        if(confirm("Del Cat?")){categories=categories.filter(c=>c.id!==id); if(activeCatId===id) activeCatId=categories[0]?.id; save(); renderUI();} 
    }
    
    renderUI();
</script>
</body>
</html>